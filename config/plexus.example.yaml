###############################################################################
# Plexus Configuration Documentation
###############################################################################
#
# This file configures the Plexus 2 gateway, defining how requests are routed
# and transformed between different LLM providers.
#
# 1. PROVIDERS SECTION
# --------------------
# Define your upstream AI providers here.
#
#   type:         The transformer architecture used by the provider.
#                 Common values: chat, messages, gemini.
#   display_name: A friendly name for logging and metadata.
#   api_base_url: The root endpoint for the provider's API.
#   api_key:      Your authentication token for the provider.
#                 OR use OAuth authentication (see below).
#   models:       A list of raw model identifiers supported by this provider.
#                 OR a map of model names to configuration (e.g. pricing).
#   headers:      (Optional) Custom HTTP headers to include in every request.
#
#   OAuth Authentication (Alternative to api_key):
#   oauth_provider:      The OAuth system to use (e.g., 'antigravity').
#   oauth_account_pool:  Array of authenticated account emails (min 1 required).
#                        Enables automatic load balancing with per-account
#                        rate limit handling. Authenticate accounts via the
#                        OAuth page in the Plexus dashboard (/ui/oauth).
#
# 2. MODELS SECTION (ALIASES)
# ---------------------------
# Define friendly "Model Aliases" that your clients will use.
#
#   selector:     (Optional) The strategy to select a target.
#                 Options: 'random' (default), 'cost', 'performance', 'latency', 'in_order'.
#                 If multiple targets are available, Plexus will prioritize
#                 selection based on the defined 'selector'.
#                   - random: Randomly selects a healthy target.
#                   - in_order: Selects providers in the order defined. Falls back to next if current is unhealthy.
#                   - cost: Selects the target with the lowest configured cost.
#                   - performance: Selects the target with the highest average tokens/sec.
#                   - latency: Selects the target with the lowest average time-to-first-token.
#
# 3. KEYS SECTION
# ---------------
# Define valid API keys for accessing the Plexus gateway.
#
#   secret:       The actual bearer token string clients must provide.
#   comment:      (Optional) Description or owner of the key.
#
###############################################################################

# [REQUIRED] Admin Key for Dashboard and Management API Access
adminKey: "change-me-to-a-secure-admin-password"

providers:
  # Standard OpenAI Configuration
  openai:
    type: chat
    display_name: OpenAI
    api_base_url: https://api.openai.com/v1
    api_key: "your-openai-api-key-here"
    models:
      - gpt-4o
      - gpt-4o-mini
      - o1-preview

  # Standard Anthropic Configuration
  anthropic:
    type: messages
    display_name: Anthropic Claude
    api_base_url: https://api.anthropic.com/v1
    api_key: "your-anthropic-api-key-here"
    models:
      - claude-3-5-sonnet-latest
      - claude-3-5-haiku-latest
      - claude-3-opus-latest

  # Standard Google Gemini Configuration
  gemini:
    type: gemini
    display_name: Google Gemini
    api_base_url: https://generativelanguage.googleapis.com
    api_key: "your-gemini-api-key-here"
    models:
      - gemini-1.5-pro
      - gemini-1.5-flash
      - gemini-2.0-flash-exp

  # Example with Pricing Configuration
  # Pricing is per 1M tokens.
  openai_cost_tracked:
    type: chat
    display_name: OpenAI (Tracked)
    api_base_url: https://api.openai.com/v1
    api_key: "your-openai-api-key-here"
    models:
      gpt-4o:
        pricing:
          source: simple
          input: 2.50
          output: 10.00
      gpt-4o-mini:
        pricing:
          source: simple
          input: 0.15
          output: 0.60

  # Example with Tiered Pricing Configuration (Defined Strategy)
  # Pricing changes based on input token usage volume.
  tiered_pricing_example:
    type: chat
    display_name: Tiered Pricing Provider
    api_base_url: https://api.example.com/v1
    api_key: "your-api-key"
    models:
      tiered-model-v1:
        pricing:
          source: defined
          range:
            # Tier 1: 0 - 1M tokens
            - lower_bound: 0
              upper_bound: 1000000
              input_per_m: 5.00
              output_per_m: 15.00
            # Tier 2: > 1M tokens
            - lower_bound: 1000001
              upper_bound: .inf
              input_per_m: 4.00
              output_per_m: 12.00

  # Example of a Chat-compatible provider (e.g. Together, DeepSeek, Groq)
  deepseek:
    type: chat
    display_name: DeepSeek
    api_base_url: https://api.deepseek.com
    api_key: "your-deepseek-api-key-here"
    models:
      - deepseek-chat
      - deepseek-reasoner

  # Example of a multi-protocol provider
  # This provider supports both OpenAI (chat) and Anthropic (messages) formats
  synthetic:
    type: ["chat", "messages"]
    display_name: Synthetic Provider
    # Map API types to specific base URLs
    api_base_url:
      chat: https://api.synthetic.new/openai/v1
      messages: https://api.synthetic.new/messages/v1
    api_key: "your-synthetic-key"
    models:
      # This model can be accessed via both formats
      "hf:MiniMaxAI/MiniMax-M2.1":
        access_via: ["chat", "messages"]
      # This model only supports the messages format
      "legacy-model":
        access_via: ["messages"]

  # Example with custom headers and OpenRouter pricing lookup
  openrouter:
    type: chat
    display_name: OpenRouter
    api_base_url: https://openrouter.ai/api/v1
    api_key: "your-openrouter-key-here"
    # Optional global discount for this provider (e.g., 5% off)
    discount: 0.05
    models:
      google/gemini-pro-1.5:
        pricing:
          source: openrouter
          slug: google/gemini-pro-1.5
      # Example with discount (e.g., 10% off list price)
      anthropic/claude-3.5-sonnet:
        pricing:
          source: openrouter
          slug: anthropic/claude-3.5-sonnet
          discount: 0.1
    headers:
      "HTTP-Referer": "https://your-app.com"
      "X-Title": "My Plexus App"

  # OAuth Provider with Multiple Accounts (Google Antigravity Example)
  # ===================================================================
  # OAuth providers support multiple authenticated accounts per provider.
  # This enables automatic load balancing with per-account rate limit handling.
  #
  # Key Features:
  # - Round-robin load balancing across healthy accounts
  # - Per-account cooldown tracking (not per-provider)
  # - Automatic failover to healthy accounts when one hits rate limits
  # - Dynamic cooldown duration parsing from API error responses
  #
  # Setup Instructions:
  # 1. Visit the OAuth page in the Plexus dashboard (/ui/oauth)
  # 2. Click "Connect to Google Antigravity" for each account you want to add
  # 3. Complete the OAuth flow for each Google account
  # 4. Add the authenticated email addresses to oauth_account_pool below
  my-antigravity:
    type: antigravity
    display_name: Google Antigravity (Multi-Account)
    api_base_url: https://cloudcode-pa.googleapis.com
    # oauth_provider: Specifies which OAuth system to use
    oauth_provider: antigravity
    # oauth_account_pool: List of authenticated account emails
    # - REQUIRED: Must contain at least 1 account
    # - Add multiple accounts for automatic load balancing
    # - Requests distribute round-robin across healthy accounts
    # - Accounts on cooldown are automatically skipped
    oauth_account_pool:
      - user1@company.com
      - user2@company.com
      - user3@company.com
    models:
      gemini-2.0-flash-thinking-exp:
        pricing:
          source: simple
          input: 0    # Free tier pricing
          output: 0   # Free tier pricing
        access_via: [antigravity]
      gemini-2.0-flash-exp:
        pricing:
          source: simple
          input: 0
          output: 0
        access_via: [antigravity]

  # OAuth Provider with Single Account (Minimum Configuration)
  my-antigravity-single:
    type: antigravity
    display_name: Google Antigravity (Single Account)
    api_base_url: https://cloudcode-pa.googleapis.com
    oauth_provider: antigravity
    # Even with single account, oauth_account_pool is required
    oauth_account_pool:
      - primary-user@company.com
    models:
      - gemini-2.0-flash-thinking-exp

  # Claude Code OAuth Provider Example
  # ===================================================================
  # Claude Code OAuth enables authentication to Anthropic's API using OAuth 2.0
  # via the Claude Code CLI credentials system.
  #
  # Key Features:
  # - OAuth 2.0 with PKCE authentication flow
  # - Multi-account support with automatic load balancing
  # - Automatic token refresh (4 hours before expiry)
  # - Per-account cooldown tracking for rate limit handling
  # - Organization-level authentication via claude.ai
  #
  # Setup Instructions:
  # 1. Visit the OAuth page in the Plexus dashboard (/ui/oauth)
  # 2. Click "Connect to Claude Code"
  # 3. Sign in with your Anthropic account (claude.ai)
  # 4. Grant the required permissions
  # 5. Add your authenticated email(s) to oauth_account_pool below
  #
  # Requirements:
  # - type MUST be 'messages' (Claude Code OAuth only works with Messages API)
  # - api_base_url should be https://api.anthropic.com/v1
  # - oauth_provider MUST be 'claude-code'
  # - oauth_account_pool is REQUIRED (minimum 1 account)
  my-claude-code:
    type: messages
    display_name: Claude Code (Multi-Account)
    api_base_url: https://api.anthropic.com/v1
    # oauth_provider: Specifies Claude Code OAuth authentication
    oauth_provider: claude-code
    # oauth_account_pool: List of authenticated Anthropic account emails
    # - REQUIRED: Must contain at least 1 account
    # - Add multiple accounts for automatic load balancing
    # - Requests distribute round-robin across healthy accounts
    # - Accounts on cooldown are automatically skipped
    oauth_account_pool:
      - user1@company.com
      - user2@company.com
      - user3@company.com
    models:
      claude-sonnet-4-5:
        pricing:
          source: simple
          input: 3.00    # $3 per 1M input tokens
          output: 15.00  # $15 per 1M output tokens
        access_via: [messages]
      claude-opus-4-5:
        pricing:
          source: simple
          input: 15.00   # $15 per 1M input tokens
          output: 75.00  # $75 per 1M output tokens
        access_via: [messages]
      claude-3-5-sonnet-latest:
        pricing:
          source: simple
          input: 3.00
          output: 15.00
        access_via: [messages]

  # Claude Code OAuth with Single Account (Minimum Configuration)
  my-claude-code-single:
    type: messages
    display_name: Claude Code (Single Account)
    api_base_url: https://api.anthropic.com/v1
    oauth_provider: claude-code
    oauth_account_pool:
      - primary-user@company.com
    models:
      - claude-sonnet-4-5
      - claude-opus-4-5

models:
  # Basic alias routing to a single target
  smart-model:
    targets:
      - provider: anthropic
        model: claude-3-5-sonnet-latest

  # Alias with additional aliases
  # Requests to 'gpt-4' or 'gpt-4-turbo' will also route here
  gpt-4-wrapper:
    additional_aliases:
      - gpt-4
      - gpt-4-turbo
    targets:
      - provider: openai
        model: gpt-4o

  # Alias routing to a Chat-compatible backend
  fast-model:
    targets:
      - provider: openai
        model: gpt-4o-mini

  # Reasoning model alias
  reasoning-model:
    targets:
      - provider: deepseek
        model: deepseek-reasoner

  # Example of Load Balancing with Explicit Selector
  # Requests to 'balanced-model' will distribute randomly across these two targets
  balanced-model:
    selector: random
    # Optional: prioritizing native API matching over the selector
    # If a client sends an Anthropic request, Plexus will prefer the 'anthropic' provider
    priority: api_match
    targets:
      - provider: openai
        model: gpt-4o
      - provider: anthropic
        model: claude-3-5-sonnet-latest

  # Example using Performance Selector (Fastest TPS)
  fastest-throughput-model:
    selector: performance
    targets:
      - provider: groq
        model: llama-3.1-70b
      - provider: openai
        model: gpt-4o-mini

  # Example using Latency Selector (Lowest TTFT)
  lowest-latency-model:
    selector: latency
    targets:
      - provider: anthropic
        model: claude-3-5-haiku-latest
      - provider: openai
        model: gpt-4o-mini

  # Example using InOrder Selector (Defined Order with Fallback)
  # Requests route to 'kilo' first, then 'naga', then 'synthetic' if earlier ones are unavailable
  minimax-m2.1:
    selector: in_order
    targets:
      - provider: kilo
        model: minimax/minimax-m2.1
      - provider: naga
        model: minimax-m2.1
      - provider: synthetic
        model: "hf:MiniMaxAI/MiniMax-M2.1"

  # OAuth Provider Routing Example
  # Route requests to OAuth-authenticated Antigravity accounts
  gemini-thinking:
    targets:
      - provider: my-antigravity
        model: gemini-2.0-flash-thinking-exp

  # Multi-Target with OAuth Provider
  # Load balances between OAuth-enabled Antigravity and API-key OpenAI
  hybrid-smart-model:
    selector: random
    targets:
      - provider: my-antigravity
        model: gemini-2.0-flash-thinking-exp
      - provider: openai
        model: gpt-4o

  # Claude Code OAuth Routing Example
  # Route requests to OAuth-authenticated Claude Code accounts
  claude-sonnet:
    targets:
      - provider: my-claude-code
        model: claude-sonnet-4-5

  # Claude Code with Cost-Based Selection
  # Automatically selects cheapest available Claude model
  claude-smart:
    selector: cost
    targets:
      - provider: my-claude-code
        model: claude-3-5-sonnet-latest
      - provider: my-claude-code
        model: claude-sonnet-4-5

  # Hybrid Multi-Provider with Claude Code OAuth
  # Load balances between OAuth Claude Code and standard Anthropic API key
  claude-hybrid:
    selector: random
    targets:
      - provider: my-claude-code
        model: claude-sonnet-4-5
      - provider: anthropic
        model: claude-3-5-sonnet-latest

keys:
  # Example API Key for accessing Plexus
  my-app-key:
    secret: "sk-plexus-example-key-123"
    comment: "Key for the main application"
  
  # Another key for testing
  test-key:
    secret: "sk-plexus-test-key-456"
    comment: "CI/CD Test Key"